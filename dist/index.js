class m extends Error{response;request;options;constructor(e,s,r){const n=e.status||e.status===0?e.status:"",i=e.statusText??"",o=`${n} ${i}`.trim(),a=o?`status code ${o}`:"an unknown error";super(`Request failed with ${a}: ${s.method} ${s.url}`),this.name="HTTPError",this.response=e,this.request=s,this.options=r}}class k extends Error{name="NonError";value;constructor(e){let s="Non-error value was thrown";try{typeof e=="string"?s=e:e&&typeof e=="object"&&"message"in e&&typeof e.message=="string"&&(s=e.message)}catch{}super(s),this.value=e}}class p extends Error{name="ForceRetryError";customDelay;code;customRequest;constructor(e){const s=e?.cause?e.cause instanceof Error?e.cause:new k(e.cause):void 0;super(e?.code?`Forced retry: ${e.code}`:"Forced retry",s?{cause:s}:void 0),this.customDelay=e?.delay,this.code=e?.code,this.customRequest=e?.request}}const R=(()=>{let t=!1,e=!1;const s=typeof globalThis.ReadableStream=="function",r=typeof globalThis.Request=="function";if(s&&r)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type")}catch(n){if(n instanceof Error&&n.message==="unsupported BodyInit type")return!1;throw n}return t&&!e})(),I=typeof globalThis.AbortController=="function",S=typeof globalThis.AbortSignal=="function"&&typeof globalThis.AbortSignal.any=="function",L=typeof globalThis.ReadableStream=="function",N=typeof globalThis.FormData=="function",q=["get","post","put","patch","head","delete"],$={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*",bytes:"*/*"},y=2147483647,D=new TextEncoder().encode("------WebKitFormBoundaryaxpyiPgbbPti10Rw").length,x=Symbol("stop");class P{options;constructor(e){this.options=e}}const H=t=>new P(t),z={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,onUploadProgress:!0,fetch:!0,context:!0},M={next:!0},F={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,duplex:!0},V=t=>{if(!t)return 0;if(t instanceof FormData){let e=0;for(const[s,r]of t)e+=D,e+=new TextEncoder().encode(`Content-Disposition: form-data; name="${s}"`).length,e+=typeof r=="string"?new TextEncoder().encode(r).length:r.size;return e}if(t instanceof Blob)return t.size;if(t instanceof ArrayBuffer)return t.byteLength;if(typeof t=="string")return new TextEncoder().encode(t).length;if(t instanceof URLSearchParams)return new TextEncoder().encode(t.toString()).length;if("byteLength"in t)return t.byteLength;if(typeof t=="object"&&t!==null)try{const e=JSON.stringify(t);return new TextEncoder().encode(e).length}catch{return 0}return 0},E=(t,e,s)=>{let r,n=0;return t.pipeThrough(new TransformStream({transform(i,o){if(o.enqueue(i),r){n+=r.byteLength;let a=e===0?0:n/e;a>=1&&(a=1-Number.EPSILON),s?.({percent:a,totalBytes:Math.max(e,n),transferredBytes:n},r)}r=i},flush(){r&&(n+=r.byteLength,s?.({percent:1,totalBytes:Math.max(e,n),transferredBytes:n},r))}}))},B=(t,e)=>{if(!t.body)return t;if(t.status===204)return new Response(null,{status:t.status,statusText:t.statusText,headers:t.headers});const s=Math.max(0,Number(t.headers.get("content-length"))||0);return new Response(E(t.body,s,e),{status:t.status,statusText:t.statusText,headers:t.headers})},J=(t,e,s)=>{if(!t.body)return t;const r=V(s??t.body);return new Request(t,{duplex:"half",body:E(t.body,r,e)})},h=t=>t!==null&&typeof t=="object",l=(...t)=>{for(const e of t)if((!h(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return w({},...t)},A=(t={},e={})=>{const s=new globalThis.Headers(t),r=e instanceof globalThis.Headers,n=new globalThis.Headers(e);for(const[i,o]of n.entries())r&&o==="undefined"||o===void 0?s.delete(i):s.set(i,o);return s};function d(t,e,s){return Object.hasOwn(e,s)&&e[s]===void 0?[]:w(t[s]??[],e[s]??[])}const j=(t={},e={})=>({beforeRequest:d(t,e,"beforeRequest"),beforeRetry:d(t,e,"beforeRetry"),afterResponse:d(t,e,"afterResponse"),beforeError:d(t,e,"beforeError")}),W=(t,e)=>{const s=new URLSearchParams;for(const r of[t,e])if(r!==void 0)if(r instanceof URLSearchParams)for(const[n,i]of r.entries())s.append(n,i);else if(Array.isArray(r))for(const n of r){if(!Array.isArray(n)||n.length!==2)throw new TypeError("Array search parameters must be provided in [[key, value], ...] format");s.append(String(n[0]),String(n[1]))}else if(h(r))for(const[n,i]of Object.entries(r))i!==void 0&&s.append(n,String(i));else{const n=new URLSearchParams(r);for(const[i,o]of n.entries())s.append(i,o)}return s},w=(...t)=>{let e={},s={},r={},n;const i=[];for(const o of t)if(Array.isArray(o))Array.isArray(e)||(e=[]),e=[...e,...o];else if(h(o)){for(let[a,c]of Object.entries(o)){if(a==="signal"&&c instanceof globalThis.AbortSignal){i.push(c);continue}if(a==="context"){if(c!=null&&(!h(c)||Array.isArray(c)))throw new TypeError("The `context` option must be an object");e={...e,context:c==null?{}:{...e.context,...c}};continue}if(a==="searchParams"){c==null?n=void 0:n=n===void 0?c:W(n,c);continue}h(c)&&a in e&&(c=w(e[a],c)),e={...e,[a]:c}}h(o.hooks)&&(r=j(r,o.hooks),e.hooks=r),h(o.headers)&&(s=A(s,o.headers),e.headers=s)}return n!==void 0&&(e.searchParams=n),i.length>0&&(i.length===1?e.signal=i[0]:S?e.signal=AbortSignal.any(i):e.signal=i.at(-1)),e.context===void 0&&(e.context={}),e},_=t=>q.includes(t)?t.toUpperCase():t,X=["get","put","head","delete","options","trace"],G=[408,413,429,500,502,503,504],Y=[413,429,503],T={limit:2,methods:X,statusCodes:G,afterStatusCodes:Y,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:t=>.3*2**(t-1)*1e3,jitter:void 0,retryOnTimeout:!1},K=(t={})=>{if(typeof t=="number")return{...T,limit:t};if(t.methods&&!Array.isArray(t.methods))throw new Error("retry.methods must be an array");if(t.statusCodes&&!Array.isArray(t.statusCodes))throw new Error("retry.statusCodes must be an array");return{...T,...t}};class g extends Error{request;constructor(e){super(`Request timed out: ${e.method} ${e.url}`),this.name="TimeoutError",this.request=e}}async function Q(t,e,s,r){return new Promise((n,i)=>{const o=setTimeout(()=>{s&&s.abort(),i(new g(t))},r.timeout);r.fetch(t,e).then(n).catch(i).then(()=>{clearTimeout(o)})})}async function Z(t,{signal:e}){return new Promise((s,r)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",n,{once:!0}));function n(){clearTimeout(i),r(e.reason)}const i=setTimeout(()=>{e?.removeEventListener("abort",n),s()},t)})}const ee=(t,e)=>{const s={};for(const r in e)Object.hasOwn(e,r)&&!(r in F)&&!(r in z)&&(!(r in t)||r in M)&&(s[r]=e[r]);return s},te=t=>t===void 0?!1:Array.isArray(t)?t.length>0:t instanceof URLSearchParams?t.size>0:typeof t=="object"?Object.keys(t).length>0:typeof t=="string"?t.trim().length>0:!!t;function se(t){return t instanceof m||t?.name===m.name}function re(t){return t instanceof g||t?.name===g.name}class f{static create(e,s){const r=new f(e,s),n=async()=>{if(typeof r.#e.timeout=="number"&&r.#e.timeout>y)throw new RangeError(`The \`timeout\` option cannot be greater than ${y}`);await Promise.resolve();let o=await r.#y();for(const a of r.#e.hooks.afterResponse){const c=r.#h(o.clone()),u=await a(r.request,r.#a(),c,{retryCount:r.#s});if(u instanceof globalThis.Response&&(o=u),u instanceof P)throw await Promise.all([c.body?.cancel(),o.body?.cancel()]),new p(u.options)}if(r.#h(o),!o.ok&&(typeof r.#e.throwHttpErrors=="function"?r.#e.throwHttpErrors(o.status):r.#e.throwHttpErrors)){let a=new m(o,r.request,r.#a());for(const c of r.#e.hooks.beforeError)a=await c(a,{retryCount:r.#s});throw a}if(r.#e.onDownloadProgress){if(typeof r.#e.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!L)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return B(o.clone(),r.#e.onDownloadProgress)}return o},i=r.#f(n).finally(async()=>{const o=r.#o,a=[];o&&!o.bodyUsed&&a.push(o.body?.cancel()),r.request.bodyUsed||a.push(r.request.body?.cancel()),await Promise.all(a)});for(const[o,a]of Object.entries($))o==="bytes"&&typeof globalThis.Response?.prototype?.bytes!="function"||(i[o]=async()=>{r.request.headers.set("accept",r.request.headers.get("accept")||a);const c=await i;if(o==="json"){if(c.status===204)return"";const u=await c.text();return u===""?"":s.parseJson?s.parseJson(u):JSON.parse(u)}return c[o]()});return i}static#d(e){return e&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof URLSearchParams)?Object.fromEntries(Object.entries(e).filter(([,s])=>s!==void 0)):e}request;#r;#s=0;#t;#e;#o;#n;#i;constructor(e,s={}){if(this.#t=e,this.#e={...s,headers:A(this.#t.headers,s.headers),hooks:j({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},s.hooks),method:_(s.method??this.#t.method??"GET"),prefixUrl:String(s.prefixUrl||""),retry:K(s.retry),throwHttpErrors:s.throwHttpErrors??!0,timeout:s.timeout??1e4,fetch:s.fetch??globalThis.fetch.bind(globalThis),context:s.context??{}},typeof this.#t!="string"&&!(this.#t instanceof URL||this.#t instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this.#e.prefixUrl&&typeof this.#t=="string"){if(this.#t.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this.#e.prefixUrl.endsWith("/")||(this.#e.prefixUrl+="/"),this.#t=this.#e.prefixUrl+this.#t}I&&S&&(this.#n=this.#e.signal??this.#t.signal,this.#r=new globalThis.AbortController,this.#e.signal=this.#n?AbortSignal.any([this.#n,this.#r.signal]):this.#r.signal),R&&(this.#e.duplex="half"),this.#e.json!==void 0&&(this.#e.body=this.#e.stringifyJson?.(this.#e.json)??JSON.stringify(this.#e.json),this.#e.headers.set("content-type",this.#e.headers.get("content-type")??"application/json"));const r=s.headers&&new globalThis.Headers(s.headers).has("content-type");if(this.#t instanceof globalThis.Request&&(N&&this.#e.body instanceof globalThis.FormData||this.#e.body instanceof URLSearchParams)&&!r&&this.#e.headers.delete("content-type"),this.request=new globalThis.Request(this.#t,this.#e),te(this.#e.searchParams)){const i="?"+(typeof this.#e.searchParams=="string"?this.#e.searchParams.replace(/^\?/,""):new URLSearchParams(f.#d(this.#e.searchParams)).toString()),o=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,i);this.request=new globalThis.Request(o,this.#e)}if(this.#e.onUploadProgress){if(typeof this.#e.onUploadProgress!="function")throw new TypeError("The `onUploadProgress` option must be a function");if(!R)throw new Error("Request streams are not supported in your environment. The `duplex` option for `Request` is not available.");this.request=this.#l(this.request,this.#e.body??void 0)}}#c(){const e=this.#e.retry.delay(this.#s);let s=e;return this.#e.retry.jitter===!0?s=Math.random()*e:typeof this.#e.retry.jitter=="function"&&(s=this.#e.retry.jitter(e),(!Number.isFinite(s)||s<0)&&(s=e)),Math.min(this.#e.retry.backoffLimit,s)}async#p(e){if(this.#s++,this.#s>this.#e.retry.limit)throw e;const s=e instanceof Error?e:new k(e);if(s instanceof p)return s.customDelay??this.#c();if(!this.#e.retry.methods.includes(this.request.method.toLowerCase()))throw e;if(this.#e.retry.shouldRetry!==void 0){const r=await this.#e.retry.shouldRetry({error:s,retryCount:this.#s});if(r===!1)throw e;if(r===!0)return this.#c()}if(re(e)&&!this.#e.retry.retryOnTimeout)throw e;if(se(e)){if(!this.#e.retry.statusCodes.includes(e.response.status))throw e;const r=e.response.headers.get("Retry-After")??e.response.headers.get("RateLimit-Reset")??e.response.headers.get("X-RateLimit-Retry-After")??e.response.headers.get("X-RateLimit-Reset")??e.response.headers.get("X-Rate-Limit-Reset");if(r&&this.#e.retry.afterStatusCodes.includes(e.response.status)){let n=Number(r)*1e3;Number.isNaN(n)?n=Date.parse(r)-Date.now():n>=Date.parse("2024-01-01")&&(n-=Date.now());const i=this.#e.retry.maxRetryAfter??n;return n<i?n:i}if(e.response.status===413)throw e}return this.#c()}#h(e){return this.#e.parseJson&&(e.json=async()=>this.#e.parseJson(await e.text())),e}async#f(e){try{return await e()}catch(s){const r=Math.min(await this.#p(s),y);if(this.#s<1)throw s;if(await Z(r,this.#n?{signal:this.#n}:{}),s instanceof p&&s.customRequest){const n=this.#e.signal?new globalThis.Request(s.customRequest,{signal:this.#e.signal}):new globalThis.Request(s.customRequest);this.#u(n)}for(const n of this.#e.hooks.beforeRetry){const i=await n({request:this.request,options:this.#a(),error:s,retryCount:this.#s});if(i instanceof globalThis.Request){this.#u(i);break}if(i instanceof globalThis.Response)return i;if(i===x)return}return this.#f(e)}}async#y(){this.#r?.signal.aborted&&(this.#r=new globalThis.AbortController,this.#e.signal=this.#n?AbortSignal.any([this.#n,this.#r.signal]):this.#r.signal,this.request=new globalThis.Request(this.request,{signal:this.#e.signal}));for(const s of this.#e.hooks.beforeRequest){const r=await s(this.request,this.#a(),{retryCount:this.#s});if(r instanceof Response)return r;if(r instanceof globalThis.Request){this.#u(r);break}}const e=ee(this.request,this.#e);return this.#o=this.request,this.request=this.#o.clone(),this.#e.timeout===!1?this.#e.fetch(this.#o,e):Q(this.#o,e,this.#r,this.#e)}#a(){if(!this.#i){const{hooks:e,...s}=this.#e;this.#i=Object.freeze(s)}return this.#i}#u(e){this.#i=void 0,this.request=this.#l(e)}#l(e,s){return!this.#e.onUploadProgress||!e.body?e:J(e,this.#e.onUploadProgress,s??this.#e.body??void 0)}}/*! MIT License Â© Sindre Sorhus */const b=t=>{const e=(s,r)=>f.create(s,l(t,r));for(const s of q)e[s]=(r,n)=>f.create(r,l(t,n,{method:s}));return e.create=s=>b(l(s)),e.extend=s=>(typeof s=="function"&&(s=s(t??{})),b(l(t,s))),e.stop=x,e.retry=H,e},ne=b(),O=ne.create({hooks:{beforeRequest:[t=>{const e=oe();t.headers.set("Authorization","bearer "+e)}]}}),U="https://api.vimeo.com",oe=()=>localStorage.getItem("accessToken")??"c2276962367652679c309e1bb60167b7",v=t=>{const e=t.uri.split("/").pop();return{title:t.name,duration:t.duration,apiId:e,likes:t.metadata.connections.likes.total,description:t.description,views:t.stats.plays,images:t.pictures.sizes.map(s=>({width:s.width,height:s.height,url:s.link})),originalUrl:`https://vimeo.com/${e}`}},ie=async t=>{const e=`${U}/videos/${t.apiId}`,s=await O.get(e).json();return v(s)},C=async t=>{const s=t.pageInfo?.offset||0,r=s/20+1,i=`${`${U}/videos`}?per_page=20&query=${t.query}&page=${r}`,o=await O.get(i).json(),a={offset:s,resultsPerPage:20,totalResults:o.total};return{items:o.data.map(v),pageInfo:a}},ae=t=>{application.postUiMessage(t)},ce=async()=>{const t=localStorage.getItem("accessToken")??"";ae({type:"send-info",accessToken:t})};application.onUiMessage=async t=>{switch(t.type){case"get-info":await ce();break;case"set-keys":localStorage.setItem("accessToken",t.accessToken),application.createNotification({message:"Api keys Saved!"});break;case"endvideo":application.endVideo();break}};const ue=async t=>{const e=C(t),[s]=await Promise.all([e]);return{videos:s}},he=t=>{localStorage.setItem("vite-ui-theme",t)};application.onChangeTheme=async t=>{he(t)};application.onSearchAll=ue;application.onSearchVideos=C;application.onGetVideo=ie;
